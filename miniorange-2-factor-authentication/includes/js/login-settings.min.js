jQuery(document).ready(function(e){jQuery(function(){jQuery("#mo2f_grace_hour").click(function(){jQuery("#mo2f_grace_period").focus()}),jQuery("#mo2f_grace_day").click(function(){jQuery("#mo2f_grace_period").focus()})})});var nonce=loginSettings.nonce;function mo2f_showSettings(e){jQuery(e).is(":checked")?(jQuery("#"+e.id+"_settings").slideDown(),jQuery("#"+e.id+"_settings").css("display","flex"),jQuery("#"+e.id+"_save").css("display","flex"),jQuery("#"+e.id+"_save").show()):"mo2f_enable2FA"!=e.id&&!["mo2f_disable_inline_2fa","mo2f_mfa_login","mo2f_enable_shortcodes"].includes(e.id)&&(jQuery("#"+e.id+"_settings").slideUp(),jQuery("#"+e.id+"_save").css("display","none"),handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:e.id+"_disable",nonce:nonce},e.id))}function handleAjaxrequest(e,o,t){jQuery.post(e,o,function(e){jQuery("#mo2f_2fa_popup_dashboard").css("display","none"),e.success?success_msg(e.data):error_msg(e.data)})}function success_msg(e){jQuery("#wpns_nav_message").empty(),jQuery("#wpns_nav_message").append("<div id='notice_div' class='overlay_success' style='z-index:9999'><div class='popup_text'>"+e+"</div></div>"),window.onload=nav_popup()}function error_msg(e){jQuery("#wpns_nav_message").empty(),jQuery("#wpns_nav_message").append("<div id='notice_div' class='overlay_error'><div class='popup_text'>"+e+"</div></div>"),window.onload=nav_popup()}function mo2f_show_specific_twofa_settings(e){jQuery(e).is(":checked")?(jQuery("#"+e.id+"_settings").css("display","flex"),jQuery("#"+e.id+"_save").css("display","flex"),jQuery("#"+e.id+"_settings").slideDown()):(jQuery("#"+e.id+"_settings").slideUp(),jQuery("#"+e.id+"_save").css("display","none"),jQuery("#"+e.id+"_settings").css("display","none"))}function selectAllRoles(e){let o=document.querySelectorAll("#mo2f_role_checkbox");o.forEach(function(o){o.checked=e.checked}),e.checked?document.getElementById("mo2f_enable2FA").checked=!0:document.getElementById("mo2f_enable2FA").checked=!1}function updateSelectAll(e){let o=[...document.querySelectorAll("#mo2f_role_checkbox")].every(function(e){return e.checked});document.getElementById("mo2f_select_all_roles").checked=o,e.checked||(document.getElementById("mo2f_select_all_roles").checked=!1);let t=[...document.querySelectorAll("#mo2f_role_checkbox")].some(function(e){return e.checked});t||(document.getElementById("mo2f_enable2FA").checked=!1)}function mo2f_enable_new_ip_notification(){var e=jQuery("#mo2f_new_ip_login_notification").is(":checked");handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:"mo2f_new_ip_login_notification",nonce:nonce,is_notification_enabled:e},"#mo2f_new_ip_login_notification")}function mo2fShowLoader(){jQuery("#mo2f_2fa_popup_dashboard").html("<span class='mo2f_loader' id='mo2f_loader'></span>"),jQuery("#mo2f_2fa_popup_dashboard").css("display","block")}jQuery("#mo2f_enable2FA_save_button").click(function(){mo2fShowLoader();var e=jQuery(this).attr("id"),o=[];$.each(jQuery("input[name='role']:checked"),function(){o.push($(this).val())});var t=jQuery("#mo2f_enable2FA").is(":checked");handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:"mo2f_enable2FA_save_option",nonce:nonce,mo2f_enable_2fa_settings:t,enabledrole:o,mo2f_graceperiod_value:jQuery("#mo2f_grace_period").val(),mo2f_graceperiod_type:jQuery('input[name="mo2f_graceperiod_type"]:checked').val(),mo2f_graceperiod_action:jQuery('input[name="mo2f_grace_period_action"]:checked').val()},e)}),jQuery("#mo2f_enable_graceperiod_save").click(function(){mo2fShowLoader();var e=jQuery(this).attr("id"),o=jQuery("#mo2f_enable_graceperiod").is(":checked");handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:"mo2f_graceperiod_save_option",nonce:nonce,mo2f_enable_graceperiod_settings:o,mo2f_graceperiod_value:jQuery("#mo2f_grace_period").val(),mo2f_graceperiod_type:jQuery('input[name="mo2f_graceperiod_type"]:checked').val(),mo2f_graceperiod_action:jQuery('input[name="mo2f_grace_period_action"]:checked').val()},e)}),jQuery(document).on("click",".mo2f-add-row",function(){let e=jQuery(this).closest("tr"),o=e.clone();o.find("input").val(""),o.find("select").prop("selectedIndex",0);let t=[];jQuery("select.mo2f_redirect_url_roles").each(function(){t.push(jQuery(this).val())});let n=!1;if(o.find("select option").each(function(){t.includes(jQuery(this).val())?jQuery(this).remove():n=!0}),!n){error_msg("No roles are available to select.");return}e.after(o)}),jQuery(document).on("click",".mo2f-remove-row",function(){let e=jQuery(this).closest("tr");if(jQuery("#mo2f_custom_redirect_url_table tr").length>2){let o=e.find("select.mo2f_redirect_url_roles").val(),t=e.find("select.mo2f_redirect_url_roles option:selected").text();e.remove(),jQuery("select.mo2f_redirect_url_roles").each(function(){jQuery(this).find(`option[value="${o}"]`).length||jQuery(this).append(`<option value="${o}">${t}</option>`)})}else error_msg("This row cannot be removed.")}),jQuery("#mo2f_add_custom_redirect_url").click(function(){var e=jQuery("#mo2f_custom_redirect_url_table tr:last"),o=e.clone();o.find("#mo2f_add_custom_redirect_url").remove(),e.after(o)}),jQuery("#mo2f_enable_custom_redirect_save_button").click(function(){mo2fShowLoader();var e=jQuery(this).attr("id"),o=jQuery("#mo2f_enable_custom_redirect").is(":checked");let t=document.querySelectorAll(".mo2f_custom_redirections_roles"),n=document.querySelectorAll(".mo2f_custom_redirections_urls"),c=[],i=[];t.forEach(function(e){let o=e.querySelector(".mo2f_redirect_url_roles").value;c.push(o)}),n.forEach(function(e){let o=e.querySelector(".mo2f_redirection_url").value;i.push(o)});let s=c.map((e,o)=>({[e]:i[o]}));handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:"mo2f_enable_custom_redirect_option",nonce:nonce,mo2f_enable_custom_redirect:o,mo2f_redirect_url_for_users:jQuery('input[name="mo2f_redirect_url_for_users"]:checked').val(),mo2f_custom_redirect_url:jQuery("#redirect_url_all").val(),mo2f_custom_roles_and_urls:s},e)}),jQuery('input[type="checkbox"]').click(function(){var e=jQuery(this).attr("id"),o=jQuery(this).attr("name");["mo2f_disable_inline_2fa","mo2f_mfa_login","mo2f_enable_shortcodes"].includes(e)&&handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:e+"_option",nonce:nonce,[e]:jQuery("#"+e).is(":checked")},e),"role"==o&&jQuery('input[name="role"]').is(":checked")&&(document.getElementById("mo2f_enable2FA").checked=!0)}),jQuery("#mo2f_enable_backup_methods_save_button").click(function(){mo2fShowLoader();var e=jQuery(this).attr("id"),o=[];$.each(jQuery("input[name='mo2f_enabled_backup_method']:checked"),function(){o.push($(this).val())});var t=jQuery("#mo2f_enable_backup_methods").is(":checked");handleAjaxrequest(ajaxurl,{action:"mo2f_login_settings_ajax",option:"mo2f_enable_backup_methods",nonce:nonce,mo2f_enable_backup_login:t,mo2f_enabled_backup_methods:o},e)}),jQuery("#mo2f_selected_2fa_methods_save").click(function(){var e=jQuery(this).attr("id"),o=jQuery("#mo2f_select_methods_for_users").is(":checked"),t=jQuery('input[name="mo2f_methods_for_users"]:checked').val(),n={action:"mo2f_login_settings_ajax",option:"mo2f_save_selected_2fa_methods",nonce:nonce,user_roles:{},twofa_methods:[],select_methods:o,selection_type:t};jQuery('input[name="mo2f_methods[]"]:checked').each(function(){n.twofa_methods.push(jQuery(this).val())});var c=!1;if(jQuery('input[name="mo2f_user_role[]"]:checked').each(function(){var e=jQuery(this).val();if(n.user_roles[e]=[],jQuery('[data-role="'+e+'"] input:checked').each(function(){n.user_roles[e].push(jQuery(this).val())}),n.user_roles[e].length<1&&"1"!==t)return error_msg("Please select at least one 2FA method for "+e+" user role."),c=!0,!1}),c)return!1;mo2fShowLoader(),handleAjaxrequest(ajaxurl,n,e)}),jQuery("#2fa_methods_for_roles").click(function(){jQuery("#mo2f_all_2fa_methods_div").css("display","none"),jQuery("#mo2f_2fa_methods_for_roles_div").css("display","flex")}),jQuery("#2fa_methods_for_all").click(function(){jQuery("#mo2f_2fa_methods_for_roles_div").css("display","none"),jQuery("#mo2f_all_2fa_methods_div").css("display","flex")}),document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("mo2f_select_all_roles");if(!e)return;let o=document.querySelectorAll("#mo2f_role_checkbox"),t=Array.from(o).every(function(e){return e.checked});e.checked=t});